apiVersion: v1
kind: Secret
metadata:
  name: dhakacart-secrets
  namespace: default
type: Opaque
stringData:
  # Database credentials (replace with actual values)
  DB_HOST: "dhakacart-db.c9akciq32.us-east-1.rds.amazonaws.com"
  DB_PORT: "5432"
  DB_USER: "admin"
  DB_PASSWORD: "ChangeMe123!SecurePassword"
  DB_NAME: "dhakacart"
  
  # API Keys
  JWT_SECRET: "your-jwt-secret-key-change-this"
  API_KEY: "your-api-key-change-this"
  
  # SMTP Configuration (for notifications)
  SMTP_HOST: "smtp.gmail.com"
  SMTP_PORT: "587"
  SMTP_USER: "noreply@dhakacart.com"
  SMTP_PASSWORD: "your-email-password"
  
  # AWS Credentials (optional, if using EC2 roles this might not be needed)
  AWS_ACCESS_KEY_ID: "AKIA..."
  AWS_SECRET_ACCESS_KEY: "your-secret-key"
  AWS_REGION: "ap-southeast-1"
  
  # Application Configuration
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  ALLOWED_ORIGINS: "https://dhakacart.com,https://www.dhakacart.com"

---
apiVersion: v1
kind: Secret
metadata:
  name: docker-registry-secret
  namespace: default
type: kubernetes.io/dockercfg
stringData:
  .dockercfg: |
    {
      "ghcr.io": {
        "username": "your-github-username",
        "password": "your-github-token",
        "email": "your-email@example.com",
        "auth": "base64-encoded-username:token"
      }
    }

---
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
  namespace: default
type: kubernetes.io/tls
data:
  # Base64 encoded certificate and key from Let's Encrypt
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0t...

---
# Example: Using secrets in Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dhakacart-backend-example
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: dhakacart-backend:latest
        env:
        # Method 1: Direct secret reference
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: DB_HOST
        - name: DB_PORT
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: DB_PORT
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: DB_USER
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: DB_PASSWORD
        - name: DB_NAME
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: DB_NAME
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: JWT_SECRET
        - name: NODE_ENV
          valueFrom:
            secretKeyRef:
              name: dhakacart-secrets
              key: NODE_ENV
        
        # Method 2: Mount entire secret as volume (for multiple files)
        volumeMounts:
        - name: secrets
          mountPath: /etc/secrets
          readOnly: true
      
      # Image pull secret for private registries
      imagePullSecrets:
      - name: docker-registry-secret
      
      volumes:
      - name: secrets
        secret:
          secretName: dhakacart-secrets
          defaultMode: 0400  # Read-only

---
# Creation script documentation:
# To create secrets from AWS Secrets Manager:
#
# 1. Store secret in AWS Secrets Manager:
#    aws secretsmanager create-secret \
#      --name dhakacart/db-password \
#      --secret-string "YourSecurePassword" \
#      --region ap-southeast-1
#
# 2. Create Kubernetes secret from AWS:
#    kubectl create secret generic dhakacart-secrets \
#      --from-literal=DB_PASSWORD=$(aws secretsmanager get-secret-value \
#        --secret-id dhakacart/db-password \
#        --query SecretString \
#        --output text) \
#      --from-literal=DB_HOST=$(aws secretsmanager get-secret-value \
#        --secret-id dhakacart/db-host \
#        --query SecretString \
#        --output text)
#
# 3. Never commit secrets to Git!
#    - Use .gitignore to exclude secrets files
#    - Use external secret management (Sealed Secrets, External Secrets, etc.)
#
# 4. Best practices:
#    - Rotate secrets regularly
#    - Use strong passwords (min 32 chars, mixed case, numbers, symbols)
#    - Restrict secret access with RBAC
#    - Audit who accesses secrets
#    - Use secret scanning tools in CI/CD
