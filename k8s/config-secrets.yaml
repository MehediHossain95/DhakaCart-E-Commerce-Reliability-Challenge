---
# Environment Variables and Secrets for DhakaCart
# This file contains examples and should be customized with actual values
# WARNING: This file should NOT be committed to git. Use AWS Secrets Manager instead.

apiVersion: v1
kind: ConfigMap
metadata:
  name: dhakacart-config
  namespace: default
data:
  # Node.js environment
  NODE_ENV: "production"
  
  # Allowed CORS origins (comma-separated)
  ALLOWED_ORIGINS: "https://dhakacart.example.com,https://www.dhakacart.example.com"
  
  # API Configuration
  LOG_LEVEL: "info"
  API_TIMEOUT: "30000"
  
  # Database Configuration (non-sensitive)
  DB_HOST: "dhakacart-db.example.com"
  DB_PORT: "5432"
  DB_NAME: "dhakacart"
  DB_SSL: "true"
  
  # Service Discovery
  BACKEND_SERVICE_URL: "http://dhakacart-backend-service:5000"
  
  # Monitoring
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"

---
apiVersion: v1
kind: Secret
metadata:
  name: dhakacart-secrets
  namespace: default
  labels:
    app: dhakacart
type: Opaque
stringData:
  # JWT Configuration - CHANGE THIS IN PRODUCTION!
  JWT_SECRET: "your-super-secret-jwt-key-change-in-production-$(date +%s)"
  
  # Database Credentials - Rotate regularly!
  DB_USER: "dhakacart_user"
  DB_PASSWORD: "change-this-secure-password-123!"
  
  # API Keys and Tokens (if applicable)
  # API_KEY: "your-api-key-here"
  
  # Encryption Keys
  # ENCRYPTION_KEY: "your-encryption-key-here"

---
# Example: How to use secrets in Kubernetes manifests
# This is a reference for the backend deployment
# 
# spec:
#   containers:
#   - name: backend
#     env:
#     # Configuration from ConfigMap
#     - name: NODE_ENV
#       valueFrom:
#         configMapKeyRef:
#           name: dhakacart-config
#           key: NODE_ENV
#     
#     # Secrets from Secret
#     - name: JWT_SECRET
#       valueFrom:
#         secretKeyRef:
#           name: dhakacart-secrets
#           key: JWT_SECRET
#     
#     - name: DB_PASSWORD
#       valueFrom:
#         secretKeyRef:
#           name: dhakacart-secrets
#           key: DB_PASSWORD

---
# AWS Secrets Manager Integration Example
# In production, use AWS Secrets Manager instead of Kubernetes Secrets
# 
# Installation:
#   helm repo add stable https://charts.helm.sh/stable
#   helm install aws-secrets-manager stable/aws-secrets-manager --namespace kube-system
# 
# Usage in deployments:
# spec:
#   containers:
#   - name: backend
#     env:
#     - name: DHAKACART_DB_PASSWORD
#       valueFrom:
#         secretKeyRef:
#           name: dhakacart-db-password
#           key: password
# 
# The controller will automatically sync the secret from AWS Secrets Manager.

---
# Best Practices for Secrets Management:
# 
# 1. Never commit secrets to git
#    - Use git-secrets or similar hooks
#    - Add .env* and secrets files to .gitignore
# 
# 2. Use AWS Secrets Manager for production
#    - Automatic rotation
#    - Encryption at rest
#    - Audit logging
#    - Access control
# 
# 3. Restrict secret access with RBAC
#    - Only backend pods should read DB credentials
#    - Only necessary services can access secrets
# 
# 4. Rotate secrets regularly
#    - Database passwords: monthly
#    - API keys: quarterly
#    - JWT secrets: semi-annually
# 
# 5. Use TLS for all connections
#    - Database connections
#    - API communications
#    - Kubernetes API access
# 
# 6. Log secret access
#    - Monitor who accesses what secrets
#    - Alert on unusual access patterns
# 
# 7. Backup and recovery
#    - Document backup procedures
#    - Test recovery regularly
#    - Secure backup storage

---
# To apply this configuration:
#
# WARNING: Only apply ConfigMap, not the Secret examples
# kubectl apply -f k8s/config-secrets.yaml
#
# For secrets, use one of these approaches:
#
# Option 1: AWS Secrets Manager (recommended)
#   aws secretsmanager create-secret \
#     --name dhakacart/db-password \
#     --secret-string 'your-secure-password'
#
# Option 2: Kubernetes Secrets with sealed-secrets
#   kubectl create secret generic dhakacart-secrets \
#     --from-literal=DB_PASSWORD=your-secure-password \
#     -o yaml | kubeseal -f - > k8s/secrets-sealed.yaml
#
# Option 3: Kubernetes Secrets (less secure, for development only)
#   kubectl apply -f k8s/config-secrets.yaml
#
# Option 4: Environment files
#   export JWT_SECRET="your-secret"
#   export DB_PASSWORD="your-password"
#   kubectl set env deployment/dhakacart-backend \
#     JWT_SECRET=$JWT_SECRET \
#     DB_PASSWORD=$DB_PASSWORD
